<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tabel 2D Dinamis</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4 font-sans">
  <!-- Navbar -->
  <nav class="flex gap-2 mb-4">
    <button data-tab="ke" class="tab active px-3 py-2 bg-blue-500 text-white rounded">2D K-E</button>
    <button data-tab="as" class="tab px-3 py-2 bg-gray-200 rounded">2D AS</button>
    <button data-tab="askop" class="tab px-3 py-2 bg-gray-200 rounded">2D AS+KOP</button>
  </nav>

  <!-- Input pencocokan -->
  <div class="mb-4 flex items-center gap-2">
    <label class="font-bold">Masukkan angka 2D untuk cek: </label>
    <input id="inputCek" type="text" maxlength="2" class="border px-2 py-1 rounded w-20" placeholder="mis. 12">
    <button id="btnSalin" class="px-3 py-1 bg-green-500 text-white rounded">Salin Cocok</button>
  </div>

  <!-- Textarea hasil cocok -->
  <div class="mb-4">
    <label class="font-bold block mb-1">Hasil Cocok:</label>
    <textarea id="hasilCocok" rows="4" class="w-full border rounded p-2 text-sm" placeholder="Angka cocok akan tampil di sini..."></textarea>
  </div>

  <!-- Tabel-tabel -->
  <div id="tab-ke"></div>
  <div id="tab-as" class="hidden"></div>
  <div id="tab-askop" class="hidden"></div>

  <script>
    const sheetId = '1LBFj79uwQEB4uh8JT3_unOJxsYB3dgSzpslzPpgWiL8';

    function csvUrl(sheetName) {
      return `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;
    }

    async function fetchCsvAsArray(sheetName) {
      const resp = await fetch(csvUrl(sheetName));
      const text = await resp.text();
      return text.trim().split('\n').map(r => r.split(','));
    }

    function makeTable(data, columns) {
      const table = document.createElement('table');
      table.className = "w-full border border-gray-300 bg-white text-sm";
      table.innerHTML = `
        <thead class="bg-gray-200"><tr>${columns.map(c => `<th class="border px-2 py-1">${c}</th>`).join('')}</tr></thead>
        <tbody></tbody>
      `;
      const tbody = table.querySelector('tbody');
      data.forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(c => {
          const td = document.createElement('td');
          td.className = 'border px-2 py-1';
          td.textContent = c;
          tr.appendChild(td);
        });
        const tdMatch = document.createElement('td');
        tdMatch.className = 'border px-2 py-1 match';
        tr.appendChild(tdMatch);
        tbody.appendChild(tr);
      });
      return table;
    }

    // Load tiap tab
    async function loadTab(sheetName, containerId, columns) {
      const data = await fetchCsvAsArray(sheetName);
      const table = makeTable(data, columns.concat('Cocok?'));
      document.getElementById(containerId).innerHTML = '';
      document.getElementById(containerId).appendChild(table);
    }

    loadTab('2D K-E', 'tab-ke', ['Kepala','Ekor','2D']);
    loadTab('2D AS', 'tab-as', ['AS','BBFS','2D']);
    loadTab('2D AS+KOP', 'tab-askop', ['AS','BBFS','2D']);

    // Tab switching
    document.querySelectorAll(".tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(b => b.classList.remove("bg-blue-500","text-white"));
        btn.classList.add("bg-blue-500","text-white");
        ['ke','as','askop'].forEach(id => {
          document.getElementById("tab-"+id).classList.add("hidden");
        });
        document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
      });
    });

    // Pencocokan input
    const inputCek = document.getElementById("inputCek");
    const hasilCocok = document.getElementById("hasilCocok");

    inputCek.addEventListener("input", e => {
      const val = e.target.value;
      const cocokArr = [];
      document.querySelectorAll("tbody tr").forEach(tr => {
        const td2d = tr.children[2];
        const tdMatch = tr.querySelector(".match");
        if (td2d && td2d.textContent === val) {
          tdMatch.textContent = 'âœ…';
          cocokArr.push(td2d.textContent);
        } else {
          tdMatch.textContent = '';
        }
      });
      hasilCocok.value = cocokArr.join('*');
    });

    // Tombol salin
    document.getElementById("btnSalin").addEventListener("click", () => {
      hasilCocok.select();
      document.execCommand("copy");
      alert("Hasil cocok disalin!");
    });
  </script>
</body>
</html>
